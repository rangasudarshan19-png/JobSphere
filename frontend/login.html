<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - JobSphere</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ¯</text></svg>">
</head>
<body>
    <div class="container" style="max-width: 500px; padding-top: 100px; padding-bottom: 100px;">
        <!-- Logo -->
        <div class="text-center mb-2xl">
            <a href="index.html" style="text-decoration: none;">
                <h1 style="font-size: 2.5rem; margin-bottom: 10px;">
                    <span>ðŸŽ¯</span>
                    <span style="background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">JobSphere</span>
                </h1>
            </a>
            <p class="text-secondary">Welcome back! Login to your account</p>
        </div>

        <!-- Login Card -->
        <div class="card" style="padding: 40px;">
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input 
                        type="email" 
                        class="form-control" 
                        id="email" 
                        placeholder="you@example.com"
                        required
                        autocomplete="email">
                </div>

                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input 
                        type="password" 
                        class="form-control" 
                        id="password" 
                        placeholder="Enter your password"
                        required
                        autocomplete="current-password">
                </div>

                <div class="flex-between mb-lg">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="remember" style="width: auto;">
                        <span class="text-secondary">Remember me</span>
                    </label>
                    <a href="#" class="text-secondary" style="font-size: 0.9rem;">Forgot password?</a>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 20px;">
                    ðŸš€ Login to Dashboard
                </button>

                <div class="text-center">
                    <p class="text-secondary">
                        Don't have an account? 
                        <a href="signup.html" style="color: var(--primary-light); font-weight: 600;">Sign up free</a>
                    </p>
                </div>
            </form>
        </div>

        <!-- Features Preview -->
        <div class="text-center mt-xl">
            <p class="text-muted" style="font-size: 0.9rem; margin-bottom: 15px;">Join thousands using JobSphere</p>
            <div class="flex-center gap-lg text-muted" style="font-size: 0.85rem;">
                <span>âœ“ 100% Free</span>
                <span>âœ“ AI-Powered</span>
                <span>âœ“ No Credit Card</span>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script>
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            Loading.show('Logging in...');

            try {
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    // Save auth token
                    Auth.setToken(data.access_token);
                    sessionStorage.setItem('userEmail', email);
                    sessionStorage.setItem('userName', data.full_name || email.split('@')[0]);

                    // Check if user is admin
                    const userResponse = await fetch(`${API_BASE}/api/auth/me`, {
                        headers: { 'Authorization': `Bearer ${data.access_token}` }
                    });
                    
                    if (userResponse.ok) {
                        const userData = await userResponse.json();
                        
                        if (userData.is_admin) {
                            // Redirect admin to admin panel
                            Toast.show('Admin login successful! Redirecting to admin panel...', 'success');
                            setTimeout(() => {
                                window.location.href = 'admin.html';
                            }, 1000);
                        } else {
                            // Redirect regular user to dashboard
                            Toast.show('Login successful! Redirecting...', 'success');
                            setTimeout(() => {
                                window.location.href = 'dashboard.html';
                            }, 1000);
                        }
                    } else {
                        // Fallback to dashboard if user check fails
                        Toast.show('Login successful! Redirecting...', 'success');
                        setTimeout(() => {
                            window.location.href = 'dashboard.html';
                        }, 1000);
                    }
                } else {
                    Toast.show(data.detail || 'Login failed. Please check your credentials.', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                Toast.show('Connection error. Please try again.', 'error');
            } finally {
                Loading.hide();
            }
        }

        // Check if already logged in
        if (Auth.isAuthenticated()) {
            window.location.href = 'dashboard.html';
        }
    </script>
</body>
</html>
